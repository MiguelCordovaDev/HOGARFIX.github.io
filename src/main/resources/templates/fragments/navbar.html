<nav
  th:fragment="navbar"
  class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm"
>
  <div class="container-fluid">
    <a class="navbar-brand fw-bold" href="/">HogarFix</a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navbarNav" class="collapse navbar-collapse justify-content-end">
      <ul class="navbar-nav">
        <!-- Mostrar enlaces públicos sólo si no es ADMIN -->
        <li class="nav-item" th:if="${session.usuarioActual == null or session.usuarioActual?.rol?.nombre != 'ADMIN'}">
          <a class="nav-link" th:href="@{/}">Inicio</a>
        </li>
        <li class="nav-item" th:if="${session.usuarioActual == null or session.usuarioActual?.rol?.nombre != 'ADMIN'}">
          <a class="nav-link" th:href="@{/clientes/registro}">Regístrate</a>
        </li>
        <li class="nav-item" th:if="${session.usuarioActual == null or session.usuarioActual?.rol?.nombre != 'ADMIN'}">
          <a class="nav-link" th:href="@{/tecnicos/registro}">Trabaja con nosotros</a>
        </li>
        <!-- Si no hay usuario en sesión mostrar Iniciar sesión -->
        <li class="nav-item" th:if="${session.usuarioActual == null}">
          <a class="nav-link" th:href="@{/auth/login}">Iniciar sesión</a>
        </li>

        <!-- Si hay usuario en sesión mostrar nombre y menú (ocultar dropdown para ADMIN) -->
        <li class="nav-item dropdown" th:if="${session.usuarioActual != null and session.usuarioActual?.rol?.nombre != 'ADMIN'}">
          <a class="nav-link dropdown-toggle" href="#" id="userMenu" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <span th:text="${session.usuarioNombre != null} ? ${session.usuarioNombre} : ${session.usuarioActual.email}"></span>
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
            <li><a class="dropdown-item" th:href="@{/auth/redirect}">Perfil</a></li>
            <li>
              <form th:action="@{/logout}" method="post" style="display:inline">
                <button type="submit" class="dropdown-item">Cerrar sesión</button>
              </form>
            </li>
          </ul>
        </li>

        <!-- Si el usuario es ADMIN mostrar sólo cierre de sesión (sin mostrar email) -->
        <li class="nav-item" th:if="${session.usuarioActual != null and session.usuarioActual?.rol?.nombre == 'ADMIN'}">
          <form th:action="@{/logout}" method="post" style="display:inline">
            <button type="submit" class="nav-link btn btn-link text-decoration-none" style="color: rgba(255,255,255,0.9);">Cerrar sesión</button>
          </form>
        </li>
      </ul>
    </div>
  </div>
</nav>
